<!DOCTYPE html>
<html>
<head>
    <title>@ViewBag.Title</title>
    @RenderSection("head", required: false)

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" type="image/x-icon" href="~/Content/assets/images/Favicons/E-Fav.jpg">


    <!-- Global stylesheets -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700,900" rel="stylesheet" type="text/css">
    <link href="~/Content/assets/css/icons/icomoon/styles.css" rel="stylesheet" type="text/css">
    <link href="~/Content/assets/css/bootstrap.css" rel="stylesheet" type="text/css">
    <link href="~/Content/assets/css/core.css" rel="stylesheet" type="text/css">
    <link href="~/Content/assets/css/components.css" rel="stylesheet" type="text/css">
    <link href="~/Content/assets/css/colors.css" rel="stylesheet" type="text/css">
    <!-- /global stylesheets -->
    <!-- Core JS files -->
    <script type="text/javascript" src="~/Content/assets/js/plugins/loaders/pace.min.js"></script>
    <script type="text/javascript" src="~/Content/assets/js/core/libraries/jquery.min.js"></script>
    <script type="text/javascript" src="~/Content/assets/js/core/libraries/bootstrap.min.js"></script>
    <script type="text/javascript" src="~/Content/assets/js/plugins/loaders/blockui.min.js"></script>
    <!-- /core JS files -->
    <!-- libraries for tabbed input form -->
    <script type="text/javascript" src="~/Content/assets/js/plugins/forms/wizards/stepy.min.js"></script>
    <script type="text/javascript" src="~/Content/assets/js/plugins/forms/selects/select2.min.js"></script>
    <script type="text/javascript" src="~/Content/assets/js/plugins/forms/styling/uniform.min.js"></script>
    <script type="text/javascript" src="~/Content/assets/js/core/libraries/jasny_bootstrap.min.js"></script>
    <script type="text/javascript" src="~/Content/assets/js/plugins/forms/validation/validate.min.js"></script>
    <!-- /libraries for tabbed input form -->
    <!-- Theme JS files -->
    <script type="text/javascript" src="~/Content/assets/js/plugins/visualization/d3/d3.min.js"></script>
    <script type="text/javascript" src="~/Content/assets/js/plugins/visualization/d3/d3_tooltip.js"></script>
    <script type="text/javascript" src="~/Content/assets/js/plugins/forms/styling/switchery.min.js"></script>
    <script type="text/javascript" src="~/Content/assets/js/plugins/forms/styling/uniform.min.js"></script>
    <script type="text/javascript" src="~/Content/assets/js/plugins/forms/selects/bootstrap_multiselect.js"></script>
    <script type="text/javascript" src="~/Content/assets/js/plugins/ui/moment/moment.min.js"></script>
    <script type="text/javascript" src="~/Content/assets/js/plugins/pickers/daterangepicker.js"></script>



    <script type="text/javascript" src="~/Content/assets/js/plugins/tables/datatables/datatables.min.js"></script>
    <script type="text/javascript" src="~/Content/assets/js/plugins/tables/datatables/extensions/row_reorder.min.js"></script>
    <script type="text/javascript" src="~/Content/assets/js/plugins/tables/datatables/extensions/responsive.min.js"></script>
    <script type="text/javascript" src="~/Content/assets/js/plugins/tables/datatables/extensions/pdfmake/vfs_fonts.min.js"></script>
    <script type="text/javascript" src="~/Content/assets/js/plugins/tables/datatables/extensions/buttons.min.js"></script>
    <script type="text/javascript" src="~/Content/assets/js/pages/datatables_extension_buttons_html5.js"></script>


    <script type="text/javascript" src="~/Content/assets/js/core/app.js"></script>
    <script type="text/javascript" src="~/Content/assets/js/pages/datatables_extension_row_reorder.js"></script>
    <!-- libraries for tabbed input form -->
    <script type="text/javascript" src="~/Content/assets/js/pages/wizard_stepy.js"></script>
    <script type="text/javascript" src="~/Content/assets/js/plugins/ui/ripple.min.js"></script>
    <!-- /libraries for tabbed input form -->

    <script type="text/javascript" src="~/Content/assets/js/pages/dashboard.js"></script>


    <!-- /theme JS files -->
    <!-- /theme JS files -->
    <!-- /Custom add libraries -->



    <link href="~/Content/assets/css/icons/fontawesome/styles.min.css" rel="stylesheet" type="text/css">
    <link href="~/Content/assets/css/icons/fontawesome/fonts/fontawesome-webfont.svg" rel="stylesheet" type="text/css">



</head>
<body class="bg-white">


    <!-- Main navbar -->
    <div class="navbar navbar-inverse bg-blue-600">
        <div class="navbar-header">
            @*<img src="~/Content/assets/images/zymah-logo.png" alt="Logo" class="ml-20" width="150" height="60">*@

            <ul class="nav navbar-nav visible-xs-block">
                <li><a data-toggle="collapse" data-target="#navbar-mobile"><i class="icon-tree5"></i></a></li>
                <li><a class="sidebar-mobile-main-toggle"><i class="icon-paragraph-justify3"></i></a></li>
            </ul>

        </div>


        <div class="navbar-collapse collapse" id="navbar-mobile">
            <ul class="nav navbar-nav">
            </ul>

            <div class="navbar-right">

                <ul class="nav navbar-nav navbar-right">

                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle legitRipple" data-toggle="dropdown" aria-expanded="true">
                            <i class="icon-upload4"></i>
                            <span class="status-mark border-orange-400"></span>
                        </a>

                        <div class="dropdown-menu dropdown-content">
                            <div class="dropdown-content-heading">
                                Upload Processing
                            </div>

                            <div class="media-list dropdown-content-body width-350" id="progressNavDiv">
                                <Center class="startClass" id="progressNavDefaultMsg">
                                    <h5 class="text-danger">No Uploading Process Found</h5>
                                </Center>

                                <div class="startClass" id="progressNavBarDiv" style="display:none;">
                                    <div class="progress">
                                        <div id="progressNavBar" class="progress-bar" role="progressbar" style="width:0%;" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <span style="color:black;" id="progressNavText">
                                        0%
                                        <br />
                                        Processing File 0 out of 0
                                    </span>
                                </div>
                            </div>

                            <center id="progressNavErrDiv startClass" style="display:none;">
                                <hr />
                                <span class="text-danger">File upload with errors</span>
                                <br />
                                <a href="~/Content/ErrorLogs/Upload_Error_Log.xlsx" class="btn btn-primary" download="">Download</a>
                            </center>
                            <br />
                        </div>
                    </li>

                    <!--This is Manage profile Segment-->
                    <li class="dropdown dropdown-user">
                        <a class="dropdown-toggle" data-toggle="dropdown">
                            <span>loggedinUser.Name</span>
                            <i class="caret"></i>
                        </a>

                        <ul class="dropdown-menu dropdown-menu-right">
                            <li><a href="#"><i class="icon-profile"></i> Update Profile</a></li>
                            <li><a href="#"><i class="icon-lock2"></i> Update Password</a></li>
                            <li class="divider"></li>
                            <li><a href="#"><i class="icon-switch2"></i> Logout</a></li>
                        </ul>
                    </li>
                    <!--This is Manage profile Segment-->


                </ul>



            </div>
        </div>
    </div>
    <!-- /main navbar -->




    <div class="page-container bg-white">


        <!-- Main sidebar -->
        <div class="sidebar sidebar-main sidebar-default">
            <div class="sidebar-content">

                <!-- User menu -->
                <div class="sidebar-user-material">
                    <div class="category-content">
                        <div class="sidebar-user-material-content">
                            <h6>loggedinUser.Name</h6>
                            <br />
                            <span class="text-size-small">loggedinUser.Email</span>
                        </div>

                        <div class="sidebar-user-material-menu">
                            <a href="#user-nav" data-toggle="collapse"><span>My Account</span> <i class="caret"></i></a>
                        </div>
                    </div>

                    <div class="navigation-wrapper collapse" id="user-nav">
                        <ul class="navigation">
                            <li><a href="#"><i class="icon-profile"></i> <span>Update Profile</span></a></li>
                            <li><a href="#"><i class="icon-lock2"></i> <span>Update Password</span></a></li>
                            <li><a href="#"><i class="icon-switch2"></i> <span>Logout</span></a></li>
                        </ul>
                    </div>
                </div>
                <!-- /user menu -->

                <div class="sidebar-category sidebar-category-visible">
                    <div class="category-content no-padding">
                        <ul class="navigation navigation-main navigation-accordion">

                            <li class="navigation-header"><span>Main</span> <i class="icon-menu" title="Main pages"></i></li>
                            <li><a href="@Url.Action("Index", "Home")"><i class="icon-home4"></i> <span>Dashboard</span></a></li>

                            <li><a href="@Url.Action("UploadFile", "Home")"><i class="icon-file-excel"></i> <span>Upload Excel</span></a></li>

                        </ul>
                    </div>

                </div>
                <!--/main navigation-->

            </div>
        </div>
        <!-- /main sidebar -->


        <div class="bg-white">
            @RenderBody()
        </div>
    </div>

    <script>
        //function Used to hide automatically alert message after 4 seconds
        $("#alertMsg").fadeTo(4000, 500).slideUp(500, function () {
            $("#alertMsg").slideUp(600);
        });
    </script>



    <script src="~/Scripts/jquery.signalR-2.4.2.min.js"></script>
    <script src="~/signalr/hubs"></script>
    <script type="text/javascript">
        var flag = 0;

        var progress = $.connection.progressHub; //get connection with class named "ProgressHub" in DataHub folder (ProgressHub.cs)
        $.connection.hub.start().done();

        progress.client.broadcastUploadProgress = function (currentRow, totalRows, currentFile, totalFiles)
        {
            if ($('#progressNavDefaultMsg').hasClass('startClass'))
            {
                $('#progressNavDefaultMsg').removeClass('startClass');
                $('#progressNavDefaultMsg').hide();
            }


            if ($('#progressNavBarDiv').hasClass('startClass'))
            {
                $('#progressNavBarDiv').removeClass('startClass');
                $('#progressNavBarDiv').show();
            }

            if (!$('#progressNavErrDiv').hasClass('startClass'))
            {
                $('#progressNavErrDiv').addClass('startClass');
                $('#progressNavErrDiv').hide();
            }

            var percentage = parseInt(currentRow) / parseInt(totalRows);
            percentage = parseInt(percentage * 100);

            if (percentage != flag)
            {
                var barBgColor = 'red';
                if (percentage >= 33 && percentage <= 49) {
                    barBgColor = 'orange';
                }
                else if (percentage >= 50 && percentage <= 79) {
                    barBgColor = 'dodgerblue';
                }
                else if (percentage >= 80) {
                    barBgColor = 'green';
                }

                $('#progressNavBar').css({ 'width': parseInt(percentage) + '%', 'background-color': barBgColor });

                flag = percentage;
            }

            $('#progressNavText').empty().append(parseInt(percentage) + '%' +
                '<br />' +
                '<br />' +
                'Record ' + currentRow + '/' + totalRows +
                '<br />' +
                '<span class="text-blue-300">Processing File ' + currentFile + ' out of ' + totalFiles + '</span>');

        };

        progress.client.broadcastProcessCompleted = function (response, msg)
        {
           
            if (response == 0)
            {
                $('#progressNavDefaultMsg').show();
                $('#progressNavDefaultMsg').addClass('startClass');
                $('#progressNavBarDiv').hide();
                $('#progressNavBarDiv').addClass('startClass');
                $('#progressNavErrDiv').hide();
                $('#progressNavErrDiv').addClass('startClass');

                alert(msg);
            }
            else if (response == 1)
            {
                $('#progressNavDefaultMsg').show();
                $('#progressNavDefaultMsg').addClass('startClass');
                $('#progressNavBarDiv').hide();
                $('#progressNavBarDiv').addClass('startClass');
                $('#progressNavErrDiv').hide();
                $('#progressNavErrDiv').addClass('startClass');

                alert("File/s uploaded successfully");
            }
            else
            {
                $('#progressNavDefaultMsg').show();
                $('#progressNavDefaultMsg').addClass('startClass');
                $('#progressNavBarDiv').hide();
                $('#progressNavBarDiv').addClass('startClass');
                $('#progressNavErrDiv').show();
                $('#progressNavErrDiv').removeClass('startClass');

                alert("File/s uploaded with errors");
            }

        };

    </script>
</body>
</html>
